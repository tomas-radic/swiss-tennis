<div class="row">
  <div class="col">
    <p class="lead float-left">
      Zoznam zápasov (<%= @nr_all_real_matches %>)
      <%= '|' if selected_round.present? %>
      <%= round_element(selected_round, current_user) %>
    </p>
    <% if selected_season && selected_round %>
      <div class="form-group float-right">
        <%= select_tag :round_id, options_from_collection_for_select(selected_season.rounds.default, "id", "full_label", selected_round.id), class: 'form-control reloading-page', data: { url: request.path, param_name: 'round' } %>
      </div>
    <% end %>
  </div>
</div>

<% if selected_round && @nr_round_finished_matches && @nr_round_matches %>
  <%= render partial: "rounds/progress",
             locals: {
               round: selected_round,
               finished: @nr_round_finished_matches,
               total: @nr_round_matches
             }
  %>
<% end %>

<%#= render 'shared/special_instructions' unless cookies[:special_instructions_accepted] == "true" %>

<%= render "seasons/heading", season: selected_season %>

<% if @most_recent_article.present? %>
  <div class="mb-4"><%= render 'articles/tile', article: @most_recent_article, expand_content: true %></div>
<% end %>

<p class="text-center">
  <% if selected_season && selected_round && policy(Match).create? %>
    <%= link_to 'Nový zápas', new_match_path(round_id: selected_round.id), class: 'btn btn-sm btn-success' %>
  <% end %>

  <button class="btn btn-success btn-sm" type="button" data-toggle="collapse" data-target="#match-instructions" aria-expanded="false" aria-controls="match-instructions">
    Inštrukcie k zápasom
  </button>
</p>
<div class="collapse" id="match-instructions">
  <div class="card card-body text-justify">
    <small>
      Termín a miesto zápasu si dohodnite <strong>čím skôr</strong> po vyžrebovaní každého hracieho kola.
      <strong>
        Po dohodnutí zápasu informujte organizátora o mieste a čase dohodnutého zápasu správou
        na číslo 0905 289 248.
      </strong>
      Oficiálnymi loptami súťaže sú <strong>Dunlop Fort, Dunlop ATP, Head ATP a Slazenger Wimbledon</strong>.
      Iné lopty možno použiť len so súhlasom súpera.
      Podľa pravidiel súťaže sa <strong>každý zápas hrá s úplne novými loptami</strong>.
      Ak zápas dospeje do stavu 1:1 na sety, o víťazovi rozhoduje supertiebreak (tiebreak, ktorý
      sa hrá do 10 s rozdielom minimálne dvoch bodov). <strong>Ak obaja hráči súhlasia a majú
      dostatočne veľkú časovú rezervu</strong>, môžu na rozhodnutie zápasu odohrať štandardný tretí set.
      <p class="text-center"><button class="btn btn-success btn-sm mt-3" type="button" data-toggle="collapse" data-target="#match-instructions" aria-expanded="false" aria-controls="match-instructions">Ok</button></p>
      <p class="text-center"><%= link_to 'viac info', pages_about_path, class: 'text-center' %></p>
    </small>
  </div>
</div>



<% if @last_update_time.present? %>
  <div class="text-center my-3">
    <i><small>(aktualizácia: <%= I18n.localize(@last_update_time, format: :date_with_time) %>)</small></i>
    <% if @unplanned_matches_count %>
      <p class="text-danger"><i><%= unplanned_matches_info(@unplanned_matches_count) %></i></p>
    <% end %>
  </div>
<% end %>

<% if selected_round && (@planned_matches.first || @recent_matches.first || @previous_matches.first || @unplanned_matches.first) %>

  <div class="grid-wrapper matches">

    <%= render 'shared/js_filter', target_table_body: "matches", placeholder: 'meno hráča' %>
    <%= render partial: "matches/grid",
               locals: {
                 heading_text: "Naplánované",
                 matches: @planned_matches,
                 dark_css_class: "table-bg-smoke",
                 light_css_class: "table-bg-smoke",
                 info_partial_up: "matches/datetime",
                 info_partial_down: "matches/note"
               } if @planned_matches.first %>

    <%= render partial: "matches/grid",
               locals: {
                 heading_text: "Najnovšie",
                 matches: @recent_matches,
                 dark_css_class: "table-bg-darken-yellow",
                 light_css_class: "table-bg-yellow",
                 info_partial_up: "matches/score",
                 info_partial_down: "matches/datetime"
               } if @recent_matches.first %>

    <%= render partial: "matches/grid",
               locals: {
                 heading_text: "Odohraté",
                 matches: @previous_matches,
                 dark_css_class: "table-bg-darken-green",
                 light_css_class: "table-bg-green",
                 info_partial_up: "matches/score",
                 info_partial_down: "matches/datetime"
               } if @previous_matches.first %>

    <%= render partial: "matches/grid",
               locals: {
                 heading_text: "Žreb",
                 matches: @unplanned_matches,
                 dark_css_class: nil,
                 light_css_class: nil,
                 info_partial_up: "matches/datetime",
                 info_partial_down: "matches/note"
               } if @unplanned_matches.first %>

  </div>
<% else %>
  <div class="row">
    <div class="col">
      <p class="lead text-center">Žiadne zápasy.</p>
    </div>
  </div>
<% end %>

<%= render "shared/scripts_autoreload" %>
